<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>My Profile</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap');
        
        :root { 
            --purple-grad-start: #5e2a5e;
            --purple-grad-end: #2c0b2c;
            --panel-bg: #4a2c4a;
            --panel-border: #6b4b6b;
            --accent-pink: #e91e63; 
            --accent-pink-dark: #c2185b;
            --yellow: #ffc107; 
            --red: #f44336;
            --text-light: #e1bee7;
            --text-white: #ffffff; 
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        html, body { height: 100%; overflow: hidden; }
        
        body { 
            font-family: 'Roboto', sans-serif; 
            background: radial-gradient(ellipse at center, var(--purple-grad-start), var(--purple-grad-end));
            color: var(--text-light); 
            display: flex; 
            justify-content: center; 
            align-items: center; 
            padding: 5px; 
        }

        .game-container { 
            width: 100%; 
            max-width: 420px; 
            height: 100%; 
            max-height: 900px; 
            background-color: transparent; 
            border-radius: 10px; 
            overflow: hidden; 
            display: flex; 
            flex-direction: column; 
            border: 1px solid var(--panel-border); 
        }
        
        .dialog-header { display: flex; align-items: center; justify-content: space-between; padding: 12px; background-color: var(--panel-bg); flex-shrink: 0; }
        .dialog-header .header-left { display: flex; align-items: center; }
        .dialog-header .back-btn { font-size: 24px; cursor: pointer; margin-right: 15px; font-weight: bold; color: var(--text-light); text-decoration: none; }
        .dialog-header .title { font-size: 18px; font-weight: 700; color: var(--text-white); }
        .main-content { padding: 20px; overflow-y: auto; flex-grow: 1; display: flex; flex-direction: column; }
        
        .profile-summary { display: flex; flex-direction: column; align-items: center; padding: 10px 0 20px 0; }
        .profile-summary img { width: 100px; height: 100px; border-radius: 50%; border: 3px solid var(--accent-pink); margin-bottom: 15px; }
        .profile-summary .name { font-size: 22px; font-weight: 700; color: var(--text-white); margin-bottom: 5px; }
        .profile-summary .uid { font-size: 14px; color: var(--text-light); }
        .profile-balance { width: 100%; background-color: var(--panel-bg); border-radius: 8px; padding: 15px; text-align: center; margin-top: 20px; border: 1px solid var(--panel-border); }
        .profile-balance p { font-size: 14px; color: var(--text-light); margin-bottom: 5px; }
        .profile-balance h2 { font-size: 28px; font-weight: 700; color: var(--yellow); }
        .profile-menu { margin-top: 20px; display: flex; flex-direction: column; gap: 10px; }
        .profile-menu-item { display: flex; align-items: center; background-color: var(--panel-bg); padding: 15px; border-radius: 8px; cursor: pointer; transition: background-color 0.2s ease; font-size: 16px; color: var(--text-light); border: 1px solid var(--panel-border); text-decoration: none; }
        .profile-menu-item:hover { background-color: var(--panel-border); }
        .profile-menu-item .icon { font-size: 22px; margin-right: 15px; width: 25px; text-align: center; color: var(--accent-pink); }
        #logout-btn { color: var(--red) !important; }
        #logout-btn .icon { color: var(--red) !important; }
        #logout-btn:hover { background-color: rgba(244, 67, 54, 0.2); }
    </style>
</head>
<body>

    <div class="game-container">
        <!-- Main Profile Page Header -->
        <header class="dialog-header">
            <div class="header-left">
                <a href="home.html" class="back-btn">‚Üê</a>
                <span class="title">My Profile</span>
            </div>
        </header>
        
        <!-- Main Profile Page Content -->
        <main class="main-content">
            <div class="profile-summary">
                <img id="profile-dialog-img" src="https://i.pravatar.cc/150?u=guest" alt="Profile Picture">
                <span id="profile-dialog-name" class="name">Guest</span>
                <span id="profile-dialog-uid" class="uid">UID: Not logged in</span>
                <div class="profile-balance">
                    <p>Current Balance</p>
                    <h2 id="profile-dialog-balance">‚Çπ 0.00</h2>
                </div>
            </div>
            <div class="profile-menu">
                <!-- Wallet button is now an anchor tag for proper navigation -->
                <a href="withdraw.html" id="profile-wallet-btn" class="profile-menu-item"><span class="icon">üí∞</span> Wallet</a>
                <a href="promo.html" id="profile-promocode-btn" class="profile-menu-item"><span class="icon">üéüÔ∏è</span> Promo Codes</a>
                <a href="offers.html" id="profile-offers-btn" class="profile-menu-item"><span class="icon">üéÅ</span> Offers</a>
                <a href="refer.html" id="profile-refer-btn" class="profile-menu-item"><span class="icon">üë•</span> Refer & Earn</a>
                <a href="contactt.html" id="profile-contact-btn" class="profile-menu-item"><span class="icon">üìû</span> Contact Us</a>
                <div id="logout-btn" class="profile-menu-item"><span class="icon">üö™</span> Logout</div>
            </div>
        </main>
    </div>
    
    <!-- Unnecessary dialogs have been removed from here -->

    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyAc78M_nj7kJtnRCTqdEdWsiMQeq4oSuDc",
            authDomain: "spin-199a1.firebaseapp.com",
            databaseURL: "https://spin-199a1-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "spin-199a1",
            storageBucket: "spin-199a1.appspot.com",
            messagingSenderId: "201888892362",
        };
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        let loggedInUserKey = null;

        // UI Elements for Profile Page
        const profileDialogImgEl = document.getElementById('profile-dialog-img');
        const profileDialogNameEl = document.getElementById('profile-dialog-name');
        const profileDialogUidEl = document.getElementById('profile-dialog-uid');
        const profileDialogBalanceEl = document.getElementById('profile-dialog-balance');
        const logoutBtn = document.getElementById('logout-btn');
        
        // --- INITIALIZATION ---
        function init() {
            checkLoginStatus();
            logoutBtn.addEventListener('click', handleLogout);
        }

        // --- AUTH & DATA LOADING ---
        function checkLoginStatus() {
            loggedInUserKey = sessionStorage.getItem('loggedInUserKey');
            if (loggedInUserKey) {
                loadUserData(loggedInUserKey);
            } else {
                window.location.href = 'login.html';
            }
        }
        
        function loadUserData(userKey) {
            const userRef = database.ref('customers/' + userKey);
            userRef.on('value', (snapshot) => {
                if (snapshot.exists()) {
                    const userData = snapshot.val();
                    updateProfileUI(userData, userKey);
                } else {
                    alert('User account not found. Logging out.');
                    handleLogout();
                }
            });
        }
        
        function updateProfileUI(userData, userKey) {
            const balance = parseFloat(userData.balance) || 0;
            const formattedBalance = `‚Çπ ${balance.toFixed(2)}`;
            const profileImageUrl = `https://i.pravatar.cc/150?u=${userKey}`;

            profileDialogImgEl.src = profileImageUrl;
            profileDialogNameEl.textContent = userData.Naam || 'Guest';
            profileDialogUidEl.textContent = `UID: ${userKey.slice(-6)}`;
            profileDialogBalanceEl.textContent = formattedBalance;
        }

        function handleLogout() {
            if (loggedInUserKey) {
                database.ref('customers/' + loggedInUserKey).off();
            }
            sessionStorage.removeItem('loggedInUserKey');
            window.location.href = 'login.html';
        }
        
        window.onload = init;
    </script>
</body>
</html>